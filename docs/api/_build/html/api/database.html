

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Database Layer &mdash; DocTR Process API Documentation v1.0.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />


      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Field Extractors" href="extractors.html" />
    <link rel="prev" title="Processing Modules" href="processing.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >



          <a href="../index.html" class="icon icon-home">
            DocTR Process
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="processing.html">Processing Modules</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Database Layer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.DuplicateDetector"><code class="docutils literal notranslate"><span class="pre">DuplicateDetector</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetector.session"><code class="docutils literal notranslate"><span class="pre">DuplicateDetector.session</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetector.window_days"><code class="docutils literal notranslate"><span class="pre">DuplicateDetector.window_days</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetector.__init__"><code class="docutils literal notranslate"><span class="pre">DuplicateDetector.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetector.check_and_handle_duplicate"><code class="docutils literal notranslate"><span class="pre">DuplicateDetector.check_and_handle_duplicate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetector.check_duplicate"><code class="docutils literal notranslate"><span class="pre">DuplicateDetector.check_duplicate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetector.create_review_queue_entry"><code class="docutils literal notranslate"><span class="pre">DuplicateDetector.create_review_queue_entry()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetector.get_duplicate_statistics"><code class="docutils literal notranslate"><span class="pre">DuplicateDetector.get_duplicate_statistics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetector.mark_as_duplicate"><code class="docutils literal notranslate"><span class="pre">DuplicateDetector.mark_as_duplicate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult"><code class="docutils literal notranslate"><span class="pre">DuplicateDetectionResult</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult.is_duplicate"><code class="docutils literal notranslate"><span class="pre">DuplicateDetectionResult.is_duplicate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult.original_ticket_id"><code class="docutils literal notranslate"><span class="pre">DuplicateDetectionResult.original_ticket_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult.original_ticket_date"><code class="docutils literal notranslate"><span class="pre">DuplicateDetectionResult.original_ticket_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult.original_file_id"><code class="docutils literal notranslate"><span class="pre">DuplicateDetectionResult.original_file_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult.days_apart"><code class="docutils literal notranslate"><span class="pre">DuplicateDetectionResult.days_apart</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult.confidence"><code class="docutils literal notranslate"><span class="pre">DuplicateDetectionResult.confidence</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult.__init__"><code class="docutils literal notranslate"><span class="pre">DuplicateDetectionResult.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.TicketRepository"><code class="docutils literal notranslate"><span class="pre">TicketRepository</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.session"><code class="docutils literal notranslate"><span class="pre">TicketRepository.session</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.duplicate_detector"><code class="docutils literal notranslate"><span class="pre">TicketRepository.duplicate_detector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.manifest_validator"><code class="docutils literal notranslate"><span class="pre">TicketRepository.manifest_validator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.__init__"><code class="docutils literal notranslate"><span class="pre">TicketRepository.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.count_by_job"><code class="docutils literal notranslate"><span class="pre">TicketRepository.count_by_job()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.create"><code class="docutils literal notranslate"><span class="pre">TicketRepository.create()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_by_date_range"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_by_date_range()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_by_id"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_by_id()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_by_ticket_number"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_by_ticket_number()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_destination_by_name"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_destination_by_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_duplicates"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_duplicates()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_job_by_name"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_job_by_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_material_by_name"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_material_by_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_requiring_review"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_requiring_review()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_source_by_name"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_source_by_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_ticket_type_by_name"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_ticket_type_by_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.get_vendor_by_name"><code class="docutils literal notranslate"><span class="pre">TicketRepository.get_vendor_by_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.hard_delete"><code class="docutils literal notranslate"><span class="pre">TicketRepository.hard_delete()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.search"><code class="docutils literal notranslate"><span class="pre">TicketRepository.search()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.soft_delete"><code class="docutils literal notranslate"><span class="pre">TicketRepository.soft_delete()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.TicketRepository.update"><code class="docutils literal notranslate"><span class="pre">TicketRepository.update()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.TicketRepositoryError"><code class="docutils literal notranslate"><span class="pre">TicketRepositoryError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.ForeignKeyNotFoundError"><code class="docutils literal notranslate"><span class="pre">ForeignKeyNotFoundError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.ValidationError"><code class="docutils literal notranslate"><span class="pre">ValidationError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.DuplicateTicketError"><code class="docutils literal notranslate"><span class="pre">DuplicateTicketError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.create_all_tables"><code class="docutils literal notranslate"><span class="pre">create_all_tables()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.drop_all_tables"><code class="docutils literal notranslate"><span class="pre">drop_all_tables()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.seed_reference_data"><code class="docutils literal notranslate"><span class="pre">seed_reference_data()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.reset_database"><code class="docutils literal notranslate"><span class="pre">reset_database()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.create_test_database"><code class="docutils literal notranslate"><span class="pre">create_test_database()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.DatabaseConnection"><code class="docutils literal notranslate"><span class="pre">DatabaseConnection</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DatabaseConnection.__init__"><code class="docutils literal notranslate"><span class="pre">DatabaseConnection.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DatabaseConnection.close"><code class="docutils literal notranslate"><span class="pre">DatabaseConnection.close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DatabaseConnection.connect"><code class="docutils literal notranslate"><span class="pre">DatabaseConnection.connect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DatabaseConnection.connection_string"><code class="docutils literal notranslate"><span class="pre">DatabaseConnection.connection_string</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DatabaseConnection.cursor"><code class="docutils literal notranslate"><span class="pre">DatabaseConnection.cursor()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DatabaseConnection.execute_script"><code class="docutils literal notranslate"><span class="pre">DatabaseConnection.execute_script()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DatabaseConnection.from_env"><code class="docutils literal notranslate"><span class="pre">DatabaseConnection.from_env()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.DatabaseConnection.test_connection"><code class="docutils literal notranslate"><span class="pre">DatabaseConnection.test_connection()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#truck_tickets.database.create_database_schema"><code class="docutils literal notranslate"><span class="pre">create_database_schema()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#database-connection">Database Connection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.connection.get_session"><code class="docutils literal notranslate"><span class="pre">get_session()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.connection.DatabaseConnection"><code class="docutils literal notranslate"><span class="pre">DatabaseConnection</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ticket-repository">Ticket Repository</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.ticket_repository.TicketRepository"><code class="docutils literal notranslate"><span class="pre">TicketRepository</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#duplicate-detector">Duplicate Detector</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.duplicate_detector.DuplicateDetector"><code class="docutils literal notranslate"><span class="pre">DuplicateDetector</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#processing-run-ledger">Processing Run Ledger</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger"><code class="docutils literal notranslate"><span class="pre">ProcessingRunLedger</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#schema-setup">Schema Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.schema_setup.create_database_schema"><code class="docutils literal notranslate"><span class="pre">create_database_schema()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.schema_setup.seed_reference_data"><code class="docutils literal notranslate"><span class="pre">seed_reference_data()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sqlalchemy-schema-setup">SQLAlchemy Schema Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.sqlalchemy_schema_setup.create_all_tables"><code class="docutils literal notranslate"><span class="pre">create_all_tables()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#truck_tickets.database.sqlalchemy_schema_setup.seed_reference_data"><code class="docutils literal notranslate"><span class="pre">seed_reference_data()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="extractors.html">Field Extractors</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html">Data Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="exporters.html">Export Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html">CLI Interface</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DocTR Process</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api_reference.html">API Reference</a></li>
      <li class="breadcrumb-item active">Database Layer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/database.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <section id="module-truck_tickets.database">
<span id="database-layer"></span><h1>Database Layer<a class="headerlink" href="#module-truck_tickets.database" title="Link to this heading"></a></h1>
<p>Database connection and operations.</p>
<dl class="py class">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetector">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">DuplicateDetector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">120</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DuplicateDetector" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Detects duplicate tickets using 120-day rolling window.</p>
<p>This class implements the duplicate detection strategy defined in spec v1.1:
- Check for existing ticket with same (ticket_number, vendor_id)
- Within rolling 120-day window before current ticket date
- If found: Mark as duplicate and route to review queue</p>
<p class="rubric">Example</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>python
detector = DuplicateDetector(session)
result = detector.check_duplicate(</p>
<blockquote>
<div><p>ticket_number=”WM-12345678”,
vendor_id=1,
ticket_date=date(2024, 10, 17)</p>
</div></blockquote>
<p>)</p>
<dl class="simple">
<dt>if result.is_duplicate:</dt><dd><p>print(f”Duplicate found! Original: {result.original_ticket_id}”)
print(f”Days apart: {result.days_apart}”)</p>
</dd>
</dl>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetector.session">
<span class="sig-name descname"><span class="pre">session</span></span><a class="headerlink" href="#truck_tickets.database.DuplicateDetector.session" title="Link to this definition"></a></dt>
<dd><p>SQLAlchemy database session</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetector.window_days">
<span class="sig-name descname"><span class="pre">window_days</span></span><a class="headerlink" href="#truck_tickets.database.DuplicateDetector.window_days" title="Link to this definition"></a></dt>
<dd><p>Number of days for rolling window (default: 120)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetector.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">120</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DuplicateDetector.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize duplicate detector.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> – SQLAlchemy database session</p></li>
<li><p><strong>window_days</strong> – Number of days for rolling window (default: 120)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetector.check_and_handle_duplicate">
<span class="sig-name descname"><span class="pre">check_and_handle_duplicate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vendor_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticket_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult" title="truck_tickets.database.duplicate_detector.DuplicateDetectionResult"><span class="pre">DuplicateDetectionResult</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.check_and_handle_duplicate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DuplicateDetector.check_and_handle_duplicate" title="Link to this definition"></a></dt>
<dd><p>Check for duplicate and automatically handle if found.</p>
<p>This is a convenience method that combines check_duplicate(),
mark_as_duplicate(), and create_review_queue_entry() into a single call.</p>
<p>If a duplicate is found:
1. Marks the ticket as duplicate
2. Creates review queue entry
3. Returns detection result</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_number</strong> – Ticket number to check</p></li>
<li><p><strong>vendor_id</strong> – Vendor ID (can be None)</p></li>
<li><p><strong>ticket_date</strong> – Date of the ticket</p></li>
<li><p><strong>ticket_id</strong> – ID of the ticket being checked (required if duplicate found)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DuplicateDetectionResult</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a>python
result = detector.check_and_handle_duplicate(</p>
<blockquote>
<div><p>ticket_number=”WM-12345678”,
vendor_id=1,
ticket_date=date(2024, 10, 17),
ticket_id=456</p>
</div></blockquote>
<p>)</p>
<dl class="simple">
<dt>if result.is_duplicate:</dt><dd><p>print(f”Duplicate handled! Routed to review queue.”)</p>
</dd>
</dl>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a><a href="#id15"><span class="problematic" id="id16">`</span></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetector.check_duplicate">
<span class="sig-name descname"><span class="pre">check_duplicate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vendor_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticket_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult" title="truck_tickets.database.duplicate_detector.DuplicateDetectionResult"><span class="pre">DuplicateDetectionResult</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.check_duplicate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DuplicateDetector.check_duplicate" title="Link to this definition"></a></dt>
<dd><p>Check if ticket is a duplicate within rolling window.</p>
<p>Queries database for existing ticket with matching (ticket_number, vendor_id)
within the rolling window period. The window extends from (ticket_date - window_days)
to ticket_date.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_number</strong> – Ticket number to check (e.g., “WM-12345678”)</p></li>
<li><p><strong>vendor_id</strong> – Vendor ID (can be None if vendor unknown)</p></li>
<li><p><strong>ticket_date</strong> – Date of the ticket being checked</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DuplicateDetectionResult with is_duplicate=True if match found</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id17"><span class="problematic" id="id18">``</span></a><a href="#id19"><span class="problematic" id="id20">`</span></a>python
result = detector.check_duplicate(</p>
<blockquote>
<div><p>ticket_number=”WM-12345678”,
vendor_id=1,
ticket_date=date(2024, 10, 17)</p>
</div></blockquote>
<section id="id21">
<h2>)<a class="headerlink" href="#id21" title="Link to this heading"></a></h2>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetector.create_review_queue_entry">
<span class="sig-name descname"><span class="pre">create_review_queue_entry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">detected_fields</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suggested_fixes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ReviewQueue" title="truck_tickets.models.sql_processing.ReviewQueue"><span class="pre">ReviewQueue</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.create_review_queue_entry"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DuplicateDetector.create_review_queue_entry" title="Link to this definition"></a></dt>
<dd><p>Create review queue entry for duplicate ticket.</p>
<p>Routes the duplicate ticket to the review queue with WARNING severity.
Includes details about both the original and duplicate tickets for
manual review.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_id</strong> – ID of the duplicate ticket</p></li>
<li><p><strong>original_ticket_id</strong> – ID of the original ticket</p></li>
<li><p><strong>detected_fields</strong> – Dictionary of detected field values (optional)</p></li>
<li><p><strong>suggested_fixes</strong> – Dictionary of suggested corrections (optional)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Created ReviewQueue entry</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id22"><span class="problematic" id="id23">``</span></a><a href="#id24"><span class="problematic" id="id25">`</span></a>python
review_entry = detector.create_review_queue_entry(</p>
<blockquote>
<div><p>ticket_id=456,
original_ticket_id=123,
detected_fields={</p>
<blockquote>
<div><p>“ticket_number”: “WM-12345678”,
“ticket_date”: “2024-10-17”,
“vendor”: “Waste Management”</p>
</div></blockquote>
<p>},
suggested_fixes={</p>
<blockquote>
<div><p>“action”: “Verify if re-scan or legitimate duplicate load”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<section id="id26">
<h2>)<a class="headerlink" href="#id26" title="Link to this heading"></a></h2>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetector.get_duplicate_statistics">
<span class="sig-name descname"><span class="pre">get_duplicate_statistics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.get_duplicate_statistics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DuplicateDetector.get_duplicate_statistics" title="Link to this definition"></a></dt>
<dd><p>Get statistics about duplicate detection.</p>
<p>Returns counts and metrics about duplicates found in the system.
Useful for monitoring and reporting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> – Optional start date for filtering</p></li>
<li><p><strong>end_date</strong> – Optional end date for filtering</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary with duplicate statistics</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id27"><span class="problematic" id="id28">``</span></a><a href="#id29"><span class="problematic" id="id30">`</span></a>python
stats = detector.get_duplicate_statistics(</p>
<blockquote>
<div><p>start_date=date(2024, 10, 1),
end_date=date(2024, 10, 31)</p>
</div></blockquote>
<p>)
print(f”Duplicates found: {stats[‘total_duplicates’]}”)
print(f”Duplicate rate: {stats[‘duplicate_rate’]:.2%}”)
<a href="#id31"><span class="problematic" id="id32">``</span></a><a href="#id33"><span class="problematic" id="id34">`</span></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetector.mark_as_duplicate">
<span class="sig-name descname"><span class="pre">mark_as_duplicate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Duplicate</span> <span class="pre">ticket</span> <span class="pre">detected</span> <span class="pre">within</span> <span class="pre">120-day</span> <span class="pre">window'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.mark_as_duplicate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DuplicateDetector.mark_as_duplicate" title="Link to this definition"></a></dt>
<dd><p>Mark a ticket as duplicate and set review flag.</p>
<p>Updates the ticket record to:
- Set duplicate_of = original_ticket_id
- Set review_required = True
- Set review_reason = reason</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_id</strong> – ID of the duplicate ticket to mark</p></li>
<li><p><strong>original_ticket_id</strong> – ID of the original ticket</p></li>
<li><p><strong>reason</strong> – Reason for marking as duplicate</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id35"><span class="problematic" id="id36">``</span></a><a href="#id37"><span class="problematic" id="id38">`</span></a>python
detector.mark_as_duplicate(</p>
<blockquote>
<div><p>ticket_id=456,
original_ticket_id=123,
reason=”Duplicate ticket - same number and vendor”</p>
</div></blockquote>
<section id="id39">
<h2>)<a class="headerlink" href="#id39" title="Link to this heading"></a></h2>
</section>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetectionResult">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">DuplicateDetectionResult</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">is_duplicate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_ticket_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_file_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">days_apart</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">confidence</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetectionResult"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DuplicateDetectionResult" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Result of duplicate detection check.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetectionResult.is_duplicate">
<span class="sig-name descname"><span class="pre">is_duplicate</span></span><a class="headerlink" href="#truck_tickets.database.DuplicateDetectionResult.is_duplicate" title="Link to this definition"></a></dt>
<dd><p>Whether a duplicate was found</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetectionResult.original_ticket_id">
<span class="sig-name descname"><span class="pre">original_ticket_id</span></span><a class="headerlink" href="#truck_tickets.database.DuplicateDetectionResult.original_ticket_id" title="Link to this definition"></a></dt>
<dd><p>ID of the original ticket if duplicate found</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetectionResult.original_ticket_date">
<span class="sig-name descname"><span class="pre">original_ticket_date</span></span><a class="headerlink" href="#truck_tickets.database.DuplicateDetectionResult.original_ticket_date" title="Link to this definition"></a></dt>
<dd><p>Date of the original ticket</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetectionResult.original_file_id">
<span class="sig-name descname"><span class="pre">original_file_id</span></span><a class="headerlink" href="#truck_tickets.database.DuplicateDetectionResult.original_file_id" title="Link to this definition"></a></dt>
<dd><p>File path of the original ticket</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetectionResult.days_apart">
<span class="sig-name descname"><span class="pre">days_apart</span></span><a class="headerlink" href="#truck_tickets.database.DuplicateDetectionResult.days_apart" title="Link to this definition"></a></dt>
<dd><p>Number of days between original and new ticket</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetectionResult.confidence">
<span class="sig-name descname"><span class="pre">confidence</span></span><a class="headerlink" href="#truck_tickets.database.DuplicateDetectionResult.confidence" title="Link to this definition"></a></dt>
<dd><p>Confidence score of duplicate match (0.0-1.0)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateDetectionResult.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">is_duplicate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_ticket_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_file_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">days_apart</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">confidence</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetectionResult.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DuplicateDetectionResult.__init__" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">TicketRepository</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">duplicate_detector</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#truck_tickets.database.duplicate_detector.DuplicateDetector" title="truck_tickets.database.duplicate_detector.DuplicateDetector"><span class="pre">DuplicateDetector</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">manifest_validator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ManifestValidator</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Repository for truck ticket CRUD operations.</p>
<p>This repository handles all database operations for truck tickets with:
- CRUD operations (create, read, update, delete)
- Foreign key resolution by canonical names
- Duplicate detection integration
- Manifest validation integration
- Soft delete support
- Audit trail management</p>
<p class="rubric">Example</p>
<p><a href="#id40"><span class="problematic" id="id41">``</span></a><a href="#id42"><span class="problematic" id="id43">`</span></a>python
repo = TicketRepository(session)</p>
<p># Create ticket
ticket = repo.create(</p>
<blockquote>
<div><p>ticket_number=”WM-12345678”,
ticket_date=date(2024, 10, 17),
job_name=”24-105”,
material_name=”CLASS_2_CONTAMINATED”,
manifest_number=”WM-MAN-2024-001234”,
quantity=25.5,
quantity_unit=”TONS”</p>
</div></blockquote>
<p>)</p>
<p># Get by ID
ticket = repo.get_by_id(123)</p>
<p># Get by ticket number
ticket = repo.get_by_ticket_number(“WM-12345678”, vendor_id=1)</p>
<p># Update
repo.update(ticket_id=123, quantity=26.0)</p>
<p># Soft delete
repo.soft_delete(ticket_id=123)
<a href="#id44"><span class="problematic" id="id45">``</span></a><a href="#id46"><span class="problematic" id="id47">`</span></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.session">
<span class="sig-name descname"><span class="pre">session</span></span><a class="headerlink" href="#truck_tickets.database.TicketRepository.session" title="Link to this definition"></a></dt>
<dd><p>SQLAlchemy database session</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.duplicate_detector">
<span class="sig-name descname"><span class="pre">duplicate_detector</span></span><a class="headerlink" href="#truck_tickets.database.TicketRepository.duplicate_detector" title="Link to this definition"></a></dt>
<dd><p>DuplicateDetector instance</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.manifest_validator">
<span class="sig-name descname"><span class="pre">manifest_validator</span></span><a class="headerlink" href="#truck_tickets.database.TicketRepository.manifest_validator" title="Link to this definition"></a></dt>
<dd><p>ManifestValidator instance</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">duplicate_detector</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#truck_tickets.database.duplicate_detector.DuplicateDetector" title="truck_tickets.database.duplicate_detector.DuplicateDetector"><span class="pre">DuplicateDetector</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">manifest_validator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ManifestValidator</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize repository.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> – SQLAlchemy database session</p></li>
<li><p><strong>duplicate_detector</strong> – Optional duplicate detector (creates if None)</p></li>
<li><p><strong>manifest_validator</strong> – Optional manifest validator (creates if None)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.count_by_job">
<span class="sig-name descname"><span class="pre">count_by_job</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.count_by_job"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.count_by_job" title="Link to this definition"></a></dt>
<dd><p>Count tickets for a job.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>job_id</strong> – Job ID</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Number of tickets</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.create">
<span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticket_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">material_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticket_type_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'EXPORT'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">destination_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vendor_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">manifest_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Decimal" title="(in Python v3.14)"><span class="pre">Decimal</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantity_unit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">truck_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_page</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_hash</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">request_guid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_confidence</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Decimal" title="(in Python v3.14)"><span class="pre">Decimal</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_duplicates</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validate_manifest</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.create"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.create" title="Link to this definition"></a></dt>
<dd><p>Create a new truck ticket.</p>
<p>This method:
1. Resolves all foreign keys by canonical names
2. Validates manifest requirement (if enabled)
3. Checks for duplicates (if enabled)
4. Creates the ticket record
5. Commits the transaction</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_number</strong> – Ticket number from vendor</p></li>
<li><p><strong>ticket_date</strong> – Date of the ticket</p></li>
<li><p><strong>job_name</strong> – Job canonical name (e.g., “24-105”)</p></li>
<li><p><strong>material_name</strong> – Material canonical name</p></li>
<li><p><strong>ticket_type_name</strong> – Ticket type (“EXPORT” or “IMPORT”)</p></li>
<li><p><strong>source_name</strong> – Source canonical name (optional)</p></li>
<li><p><strong>destination_name</strong> – Destination canonical name (optional)</p></li>
<li><p><strong>vendor_name</strong> – Vendor canonical name (optional)</p></li>
<li><p><strong>manifest_number</strong> – Manifest number (required for contaminated)</p></li>
<li><p><strong>quantity</strong> – Quantity value</p></li>
<li><p><strong>quantity_unit</strong> – Unit of measurement</p></li>
<li><p><strong>truck_number</strong> – Truck number (v1.1 field)</p></li>
<li><p><strong>file_id</strong> – Source file path</p></li>
<li><p><strong>file_page</strong> – Page number in file</p></li>
<li><p><strong>file_hash</strong> – SHA-256 hash of file</p></li>
<li><p><strong>request_guid</strong> – Batch processing GUID</p></li>
<li><p><strong>extraction_confidence</strong> – OCR confidence score</p></li>
<li><p><strong>check_duplicates</strong> – Whether to check for duplicates (default: True)</p></li>
<li><p><strong>validate_manifest</strong> – Whether to validate manifest (default: True)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Created TruckTicket instance</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="#truck_tickets.database.ForeignKeyNotFoundError" title="truck_tickets.database.ForeignKeyNotFoundError"><strong>ForeignKeyNotFoundError</strong></a> – If required foreign key not found</p></li>
<li><p><a class="reference internal" href="#truck_tickets.database.ValidationError" title="truck_tickets.database.ValidationError"><strong>ValidationError</strong></a> – If manifest validation fails</p></li>
<li><p><a class="reference internal" href="#truck_tickets.database.DuplicateTicketError" title="truck_tickets.database.DuplicateTicketError"><strong>DuplicateTicketError</strong></a> – If duplicate detected</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id48"><span class="problematic" id="id49">``</span></a><a href="#id50"><span class="problematic" id="id51">`</span></a>python
ticket = repo.create(</p>
<blockquote>
<div><p>ticket_number=”WM-12345678”,
ticket_date=date(2024, 10, 17),
job_name=”24-105”,
material_name=”CLASS_2_CONTAMINATED”,
manifest_number=”WM-MAN-2024-001234”,
quantity=Decimal(“25.5”),
quantity_unit=”TONS”</p>
</div></blockquote>
<section id="id52">
<h2>)<a class="headerlink" href="#id52" title="Link to this heading"></a></h2>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_by_date_range">
<span class="sig-name descname"><span class="pre">get_by_date_range</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_by_date_range"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_by_date_range" title="Link to this definition"></a></dt>
<dd><p>Get tickets within date range.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> – Start date (inclusive)</p></li>
<li><p><strong>end_date</strong> – End date (inclusive)</p></li>
<li><p><strong>job_id</strong> – Optional job ID filter</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of TruckTicket instances</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_by_id">
<span class="sig-name descname"><span class="pre">get_by_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_by_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_by_id" title="Link to this definition"></a></dt>
<dd><p>Get ticket by ID.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ticket_id</strong> – Ticket ID</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>TruckTicket instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_by_ticket_number">
<span class="sig-name descname"><span class="pre">get_by_ticket_number</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vendor_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_by_ticket_number"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_by_ticket_number" title="Link to this definition"></a></dt>
<dd><p>Get ticket by ticket number and optional vendor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_number</strong> – Ticket number</p></li>
<li><p><strong>vendor_id</strong> – Optional vendor ID for disambiguation</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>TruckTicket instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_destination_by_name">
<span class="sig-name descname"><span class="pre">get_destination_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">destination_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.Destination" title="truck_tickets.models.sql_reference.Destination"><span class="pre">Destination</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_destination_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_destination_by_name" title="Link to this definition"></a></dt>
<dd><p>Get destination by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>destination_name</strong> – Destination name (e.g., “WASTE_MANAGEMENT_LEWISVILLE”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Destination instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_duplicates">
<span class="sig-name descname"><span class="pre">get_duplicates</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_duplicates"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_duplicates" title="Link to this definition"></a></dt>
<dd><p>Get all tickets marked as duplicates.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of duplicate tickets</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_job_by_name">
<span class="sig-name descname"><span class="pre">get_job_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.Job" title="truck_tickets.models.sql_reference.Job"><span class="pre">Job</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_job_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_job_by_name" title="Link to this definition"></a></dt>
<dd><p>Get job by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>job_name</strong> – Job name (e.g., “24-105”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Job instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_material_by_name">
<span class="sig-name descname"><span class="pre">get_material_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">material_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.Material" title="truck_tickets.models.sql_reference.Material"><span class="pre">Material</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_material_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_material_by_name" title="Link to this definition"></a></dt>
<dd><p>Get material by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>material_name</strong> – Material name (e.g., “CLASS_2_CONTAMINATED”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Material instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_requiring_review">
<span class="sig-name descname"><span class="pre">get_requiring_review</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_requiring_review"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_requiring_review" title="Link to this definition"></a></dt>
<dd><p>Get all tickets requiring manual review.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of tickets needing review</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_source_by_name">
<span class="sig-name descname"><span class="pre">get_source_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.Source" title="truck_tickets.models.sql_reference.Source"><span class="pre">Source</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_source_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_source_by_name" title="Link to this definition"></a></dt>
<dd><p>Get source by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>source_name</strong> – Source name (e.g., “SPG”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Source instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_ticket_type_by_name">
<span class="sig-name descname"><span class="pre">get_ticket_type_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_type_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.TicketType" title="truck_tickets.models.sql_reference.TicketType"><span class="pre">TicketType</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_ticket_type_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_ticket_type_by_name" title="Link to this definition"></a></dt>
<dd><p>Get ticket type by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ticket_type_name</strong> – Ticket type name (e.g., “EXPORT”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>TicketType instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.get_vendor_by_name">
<span class="sig-name descname"><span class="pre">get_vendor_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vendor_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.Vendor" title="truck_tickets.models.sql_reference.Vendor"><span class="pre">Vendor</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_vendor_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.get_vendor_by_name" title="Link to this definition"></a></dt>
<dd><p>Get vendor by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>vendor_name</strong> – Vendor name (e.g., “WASTE_MANAGEMENT”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Vendor instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.hard_delete">
<span class="sig-name descname"><span class="pre">hard_delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.hard_delete"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.hard_delete" title="Link to this definition"></a></dt>
<dd><p>Permanently delete ticket from database.</p>
<p>WARNING: This permanently removes the record. Use soft_delete() instead
for most cases to maintain audit trail.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ticket_id</strong> – Ticket ID to delete</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if deleted, False if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.search">
<span class="sig-name descname"><span class="pre">search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">material_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vendor_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">has_manifest</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.search" title="Link to this definition"></a></dt>
<dd><p>Search tickets with multiple filters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_number</strong> – Partial ticket number match</p></li>
<li><p><strong>job_id</strong> – Job ID filter</p></li>
<li><p><strong>material_id</strong> – Material ID filter</p></li>
<li><p><strong>vendor_id</strong> – Vendor ID filter</p></li>
<li><p><strong>start_date</strong> – Start date filter</p></li>
<li><p><strong>end_date</strong> – End date filter</p></li>
<li><p><strong>has_manifest</strong> – Filter by manifest presence</p></li>
<li><p><strong>limit</strong> – Maximum results (default: 100)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of matching tickets</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.soft_delete">
<span class="sig-name descname"><span class="pre">soft_delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.soft_delete"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.soft_delete" title="Link to this definition"></a></dt>
<dd><p>Soft delete ticket (mark as inactive, don’t remove).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ticket_id</strong> – Ticket ID to delete</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if deleted, False if not found</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This doesn’t actually delete the record, just marks it as inactive.
Use hard_delete() if you need to actually remove the record.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepository.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepository.update" title="Link to this definition"></a></dt>
<dd><p>Update ticket fields.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_id</strong> – Ticket ID to update</p></li>
<li><p><strong>**kwargs</strong> – Fields to update</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Updated TruckTicket instance</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#truck_tickets.database.TicketRepositoryError" title="truck_tickets.database.TicketRepositoryError"><strong>TicketRepositoryError</strong></a> – If ticket not found or update fails</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id53"><span class="problematic" id="id54">``</span></a><a href="#id55"><span class="problematic" id="id56">`</span></a>python
ticket = repo.update(</p>
<blockquote>
<div><p>ticket_id=123,
quantity=Decimal(“26.0”),
manifest_number=”WM-MAN-2024-001235”</p>
</div></blockquote>
<section id="id57">
<h2>)<a class="headerlink" href="#id57" title="Link to this heading"></a></h2>
</section>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="truck_tickets.database.TicketRepositoryError">
<em class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">TicketRepositoryError</span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepositoryError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.TicketRepositoryError" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></a></p>
<p>Base exception for repository errors.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="truck_tickets.database.ForeignKeyNotFoundError">
<em class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">ForeignKeyNotFoundError</span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#ForeignKeyNotFoundError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ForeignKeyNotFoundError" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#truck_tickets.database.TicketRepositoryError" title="truck_tickets.database.ticket_repository.TicketRepositoryError"><code class="xref py py-class docutils literal notranslate"><span class="pre">TicketRepositoryError</span></code></a></p>
<p>Raised when a foreign key reference cannot be resolved.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="truck_tickets.database.ValidationError">
<em class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">ValidationError</span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#ValidationError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ValidationError" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#truck_tickets.database.TicketRepositoryError" title="truck_tickets.database.ticket_repository.TicketRepositoryError"><code class="xref py py-class docutils literal notranslate"><span class="pre">TicketRepositoryError</span></code></a></p>
<p>Raised when validation fails.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="truck_tickets.database.DuplicateTicketError">
<em class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">DuplicateTicketError</span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#DuplicateTicketError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DuplicateTicketError" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#truck_tickets.database.TicketRepositoryError" title="truck_tickets.database.ticket_repository.TicketRepositoryError"><code class="xref py py-class docutils literal notranslate"><span class="pre">TicketRepositoryError</span></code></a></p>
<p>Raised when a duplicate ticket is detected.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.create_all_tables">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">create_all_tables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">engine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/core/connections.html#sqlalchemy.engine.Engine" title="(in SQLAlchemy v2.0)"><span class="pre">Engine</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/sqlalchemy_schema_setup.html#create_all_tables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.create_all_tables" title="Link to this definition"></a></dt>
<dd><p>Create all database tables from SQLAlchemy models.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>engine</strong> – SQLAlchemy engine instance</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id58"><span class="problematic" id="id59">``</span></a><a href="#id60"><span class="problematic" id="id61">`</span></a>python
from sqlalchemy import create_engine</p>
<p>engine = create_engine(‘sqlite:///truck_tickets.db’)
create_all_tables(engine)
<a href="#id62"><span class="problematic" id="id63">``</span></a><a href="#id64"><span class="problematic" id="id65">`</span></a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.drop_all_tables">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">drop_all_tables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">engine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/core/connections.html#sqlalchemy.engine.Engine" title="(in SQLAlchemy v2.0)"><span class="pre">Engine</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/sqlalchemy_schema_setup.html#drop_all_tables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.drop_all_tables" title="Link to this definition"></a></dt>
<dd><p>Drop all database tables (CAUTION: destroys all data).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>engine</strong> – SQLAlchemy engine instance</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This will permanently delete all data in the database!</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.seed_reference_data">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">seed_reference_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_code</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'24-105'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'PHMS</span> <span class="pre">New</span> <span class="pre">Pediatric</span> <span class="pre">Campus'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/sqlalchemy_schema_setup.html#seed_reference_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.seed_reference_data" title="Link to this definition"></a></dt>
<dd><p>Seed all reference data for testing and production.</p>
<dl class="simple">
<dt>Seeds:</dt><dd><ul class="simple">
<li><p>1 job (24-105)</p></li>
<li><p>12 materials (contaminated, clean, import types)</p></li>
<li><p>13 sources (construction site locations)</p></li>
<li><p>3 destinations (disposal facilities)</p></li>
<li><p>3 vendors (haulers)</p></li>
<li><p>2 ticket types (IMPORT, EXPORT)</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> – SQLAlchemy session</p></li>
<li><p><strong>job_code</strong> – Job code (default: “24-105”)</p></li>
<li><p><strong>job_name</strong> – Job name (default: “PHMS New Pediatric Campus”)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary with counts of seeded records</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id66"><span class="problematic" id="id67">``</span></a><a href="#id68"><span class="problematic" id="id69">`</span></a>python
from sqlalchemy.orm import Session</p>
<p>counts = seed_reference_data(session)
print(f”Seeded {counts[‘materials’]} materials”)
<a href="#id70"><span class="problematic" id="id71">``</span></a><a href="#id72"><span class="problematic" id="id73">`</span></a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.reset_database">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">reset_database</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">engine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/core/connections.html#sqlalchemy.engine.Engine" title="(in SQLAlchemy v2.0)"><span class="pre">Engine</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/sqlalchemy_schema_setup.html#reset_database"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.reset_database" title="Link to this definition"></a></dt>
<dd><p>Drop all tables, recreate schema, and seed reference data.</p>
<p>WARNING: This destroys all existing data!</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>engine</strong> – SQLAlchemy engine</p></li>
<li><p><strong>session</strong> – SQLAlchemy session</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">#</span> <span class="pre">Complete</span> <span class="pre">database</span> <span class="pre">reset</span>
<span class="pre">reset_database(engine,</span> <span class="pre">session)</span>
<span class="pre">`</span></code></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.create_test_database">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">create_test_database</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'test_truck_tickets.db'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.sqlalchemy.org/en/20/core/connections.html#sqlalchemy.engine.Engine" title="(in SQLAlchemy v2.0)"><span class="pre">Engine</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/sqlalchemy_schema_setup.html#create_test_database"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.create_test_database" title="Link to this definition"></a></dt>
<dd><p>Create a test database with schema and seed data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>db_path</strong> – Path to SQLite database file</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of (engine, session)</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id74"><span class="problematic" id="id75">``</span></a><a href="#id76"><span class="problematic" id="id77">`</span></a>python
# Create test database
engine, session = create_test_database(“test.db”)</p>
<p># Use for testing
from src.truck_tickets.database import TicketRepository
repo = TicketRepository(session)</p>
<p># Cleanup
session.close()
engine.dispose()
<a href="#id78"><span class="problematic" id="id79">``</span></a><a href="#id80"><span class="problematic" id="id81">`</span></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="truck_tickets.database.DatabaseConnection">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">DatabaseConnection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">server</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">database</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'TruckTicketsDB'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">driver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'{ODBC</span> <span class="pre">Driver</span> <span class="pre">17</span> <span class="pre">for</span> <span class="pre">SQL</span> <span class="pre">Server}'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">username</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">password</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trusted_connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DatabaseConnection" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Manages SQL Server database connections.</p>
<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DatabaseConnection.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">server</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">database</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'TruckTicketsDB'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">driver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'{ODBC</span> <span class="pre">Driver</span> <span class="pre">17</span> <span class="pre">for</span> <span class="pre">SQL</span> <span class="pre">Server}'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">username</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">password</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trusted_connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DatabaseConnection.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize database connection parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>server</strong> – SQL Server instance name (e.g., ‘localhost’ or ‘SERVERINSTANCE’)</p></li>
<li><p><strong>database</strong> – Database name (default: TruckTicketsDB)</p></li>
<li><p><strong>driver</strong> – ODBC driver name</p></li>
<li><p><strong>username</strong> – SQL Server username (if not using Windows auth)</p></li>
<li><p><strong>password</strong> – SQL Server password (if not using Windows auth)</p></li>
<li><p><strong>trusted_connection</strong> – Use Windows authentication if True</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DatabaseConnection.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DatabaseConnection.close" title="Link to this definition"></a></dt>
<dd><p>Close database connection.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DatabaseConnection.connect">
<span class="sig-name descname"><span class="pre">connect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.connect"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DatabaseConnection.connect" title="Link to this definition"></a></dt>
<dd><p>Establish database connection.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="truck_tickets.database.DatabaseConnection.connection_string">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">connection_string</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></em><a class="headerlink" href="#truck_tickets.database.DatabaseConnection.connection_string" title="Link to this definition"></a></dt>
<dd><p>Build ODBC connection string.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DatabaseConnection.cursor">
<span class="sig-name descname"><span class="pre">cursor</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.cursor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DatabaseConnection.cursor" title="Link to this definition"></a></dt>
<dd><p>Context manager for database cursor.</p>
<dl class="simple">
<dt>Usage:</dt><dd><dl class="simple">
<dt>with db.cursor() as cur:</dt><dd><p>cur.execute(“SELECT * FROM jobs”)
rows = cur.fetchall()</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DatabaseConnection.execute_script">
<span class="sig-name descname"><span class="pre">execute_script</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sql_script</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.execute_script"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DatabaseConnection.execute_script" title="Link to this definition"></a></dt>
<dd><p>Execute a SQL script (multiple statements).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>sql_script</strong> – SQL script with multiple statements separated by GO</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DatabaseConnection.from_env">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_env</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#truck_tickets.database.connection.DatabaseConnection" title="truck_tickets.database.connection.DatabaseConnection"><span class="pre">DatabaseConnection</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.from_env"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DatabaseConnection.from_env" title="Link to this definition"></a></dt>
<dd><p>Create connection from environment variables.</p>
<dl class="simple">
<dt>Expected variables:</dt><dd><p>TRUCK_TICKETS_DB_SERVER
TRUCK_TICKETS_DB_NAME (optional, defaults to TruckTicketsDB)
TRUCK_TICKETS_DB_USERNAME (optional for Windows auth)
TRUCK_TICKETS_DB_PASSWORD (optional for Windows auth)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.DatabaseConnection.test_connection">
<span class="sig-name descname"><span class="pre">test_connection</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.test_connection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.DatabaseConnection.test_connection" title="Link to this definition"></a></dt>
<dd><p>Test database connectivity.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if connection successful, False otherwise</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.create_database_schema">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.</span></span><span class="sig-name descname"><span class="pre">create_database_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#truck_tickets.database.connection.DatabaseConnection" title="truck_tickets.database.connection.DatabaseConnection"><span class="pre">DatabaseConnection</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/schema_setup.html#create_database_schema"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.create_database_schema" title="Link to this definition"></a></dt>
<dd><p>Create all required database tables and indexes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>db</strong> – DatabaseConnection instance</p>
</dd>
</dl>
</dd></dl>

<section id="database-connection">
<h2>Database Connection<a class="headerlink" href="#database-connection" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.connection.get_session">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.connection.</span></span><span class="sig-name descname"><span class="pre">get_session</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#get_session"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.connection.get_session" title="Link to this definition"></a></dt>
<dd><p>Get a SQLAlchemy session for database operations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>db_url</strong> – Database URL (SQLAlchemy format). If None, uses environment variable
TRUCK_TICKETS_DB_URL or defaults to sqlite:///truck_tickets.db</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>SQLAlchemy Session instance</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id82"><span class="problematic" id="id83">``</span></a><a href="#id84"><span class="problematic" id="id85">`</span></a>python
session = get_session()
try:</p>
<blockquote>
<div><p># Use session for queries
tickets = session.query(TruckTicket).all()</p>
</div></blockquote>
<dl class="simple">
<dt>finally:</dt><dd><p>session.close()</p>
</dd>
</dl>
<p><a href="#id86"><span class="problematic" id="id87">``</span></a><a href="#id88"><span class="problematic" id="id89">`</span></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="truck_tickets.database.connection.DatabaseConnection">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.connection.</span></span><span class="sig-name descname"><span class="pre">DatabaseConnection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">server</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">database</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'TruckTicketsDB'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">driver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'{ODBC</span> <span class="pre">Driver</span> <span class="pre">17</span> <span class="pre">for</span> <span class="pre">SQL</span> <span class="pre">Server}'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">username</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">password</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trusted_connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.connection.DatabaseConnection" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Manages SQL Server database connections.</p>
<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.connection.DatabaseConnection.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">server</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">database</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'TruckTicketsDB'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">driver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'{ODBC</span> <span class="pre">Driver</span> <span class="pre">17</span> <span class="pre">for</span> <span class="pre">SQL</span> <span class="pre">Server}'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">username</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">password</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trusted_connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.connection.DatabaseConnection.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize database connection parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>server</strong> – SQL Server instance name (e.g., ‘localhost’ or ‘SERVERINSTANCE’)</p></li>
<li><p><strong>database</strong> – Database name (default: TruckTicketsDB)</p></li>
<li><p><strong>driver</strong> – ODBC driver name</p></li>
<li><p><strong>username</strong> – SQL Server username (if not using Windows auth)</p></li>
<li><p><strong>password</strong> – SQL Server password (if not using Windows auth)</p></li>
<li><p><strong>trusted_connection</strong> – Use Windows authentication if True</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="truck_tickets.database.connection.DatabaseConnection.connection_string">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">connection_string</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></em><a class="headerlink" href="#truck_tickets.database.connection.DatabaseConnection.connection_string" title="Link to this definition"></a></dt>
<dd><p>Build ODBC connection string.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.connection.DatabaseConnection.connect">
<span class="sig-name descname"><span class="pre">connect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.connect"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.connection.DatabaseConnection.connect" title="Link to this definition"></a></dt>
<dd><p>Establish database connection.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.connection.DatabaseConnection.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.connection.DatabaseConnection.close" title="Link to this definition"></a></dt>
<dd><p>Close database connection.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.connection.DatabaseConnection.cursor">
<span class="sig-name descname"><span class="pre">cursor</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.cursor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.connection.DatabaseConnection.cursor" title="Link to this definition"></a></dt>
<dd><p>Context manager for database cursor.</p>
<dl class="simple">
<dt>Usage:</dt><dd><dl class="simple">
<dt>with db.cursor() as cur:</dt><dd><p>cur.execute(“SELECT * FROM jobs”)
rows = cur.fetchall()</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.connection.DatabaseConnection.execute_script">
<span class="sig-name descname"><span class="pre">execute_script</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sql_script</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.execute_script"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.connection.DatabaseConnection.execute_script" title="Link to this definition"></a></dt>
<dd><p>Execute a SQL script (multiple statements).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>sql_script</strong> – SQL script with multiple statements separated by GO</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.connection.DatabaseConnection.test_connection">
<span class="sig-name descname"><span class="pre">test_connection</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.test_connection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.connection.DatabaseConnection.test_connection" title="Link to this definition"></a></dt>
<dd><p>Test database connectivity.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if connection successful, False otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.connection.DatabaseConnection.from_env">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_env</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#truck_tickets.database.connection.DatabaseConnection" title="truck_tickets.database.connection.DatabaseConnection"><span class="pre">DatabaseConnection</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/connection.html#DatabaseConnection.from_env"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.connection.DatabaseConnection.from_env" title="Link to this definition"></a></dt>
<dd><p>Create connection from environment variables.</p>
<dl class="simple">
<dt>Expected variables:</dt><dd><p>TRUCK_TICKETS_DB_SERVER
TRUCK_TICKETS_DB_NAME (optional, defaults to TruckTicketsDB)
TRUCK_TICKETS_DB_USERNAME (optional for Windows auth)
TRUCK_TICKETS_DB_PASSWORD (optional for Windows auth)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="ticket-repository">
<h2>Ticket Repository<a class="headerlink" href="#ticket-repository" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.ticket_repository.</span></span><span class="sig-name descname"><span class="pre">TicketRepository</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">duplicate_detector</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#truck_tickets.database.duplicate_detector.DuplicateDetector" title="truck_tickets.database.duplicate_detector.DuplicateDetector"><span class="pre">DuplicateDetector</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">manifest_validator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ManifestValidator</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Repository for truck ticket CRUD operations.</p>
<p>This repository handles all database operations for truck tickets with:
- CRUD operations (create, read, update, delete)
- Foreign key resolution by canonical names
- Duplicate detection integration
- Manifest validation integration
- Soft delete support
- Audit trail management</p>
<p class="rubric">Example</p>
<p><a href="#id90"><span class="problematic" id="id91">``</span></a><a href="#id92"><span class="problematic" id="id93">`</span></a>python
repo = TicketRepository(session)</p>
<p># Create ticket
ticket = repo.create(</p>
<blockquote>
<div><p>ticket_number=”WM-12345678”,
ticket_date=date(2024, 10, 17),
job_name=”24-105”,
material_name=”CLASS_2_CONTAMINATED”,
manifest_number=”WM-MAN-2024-001234”,
quantity=25.5,
quantity_unit=”TONS”</p>
</div></blockquote>
<p>)</p>
<p># Get by ID
ticket = repo.get_by_id(123)</p>
<p># Get by ticket number
ticket = repo.get_by_ticket_number(“WM-12345678”, vendor_id=1)</p>
<p># Update
repo.update(ticket_id=123, quantity=26.0)</p>
<p># Soft delete
repo.soft_delete(ticket_id=123)
<a href="#id94"><span class="problematic" id="id95">``</span></a><a href="#id96"><span class="problematic" id="id97">`</span></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.session">
<span class="sig-name descname"><span class="pre">session</span></span><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.session" title="Link to this definition"></a></dt>
<dd><p>SQLAlchemy database session</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.duplicate_detector">
<span class="sig-name descname"><span class="pre">duplicate_detector</span></span><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.duplicate_detector" title="Link to this definition"></a></dt>
<dd><p>DuplicateDetector instance</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.manifest_validator">
<span class="sig-name descname"><span class="pre">manifest_validator</span></span><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.manifest_validator" title="Link to this definition"></a></dt>
<dd><p>ManifestValidator instance</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">duplicate_detector</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#truck_tickets.database.duplicate_detector.DuplicateDetector" title="truck_tickets.database.duplicate_detector.DuplicateDetector"><span class="pre">DuplicateDetector</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">manifest_validator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ManifestValidator</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize repository.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> – SQLAlchemy database session</p></li>
<li><p><strong>duplicate_detector</strong> – Optional duplicate detector (creates if None)</p></li>
<li><p><strong>manifest_validator</strong> – Optional manifest validator (creates if None)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_job_by_name">
<span class="sig-name descname"><span class="pre">get_job_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.Job" title="truck_tickets.models.sql_reference.Job"><span class="pre">Job</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_job_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_job_by_name" title="Link to this definition"></a></dt>
<dd><p>Get job by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>job_name</strong> – Job name (e.g., “24-105”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Job instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_material_by_name">
<span class="sig-name descname"><span class="pre">get_material_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">material_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.Material" title="truck_tickets.models.sql_reference.Material"><span class="pre">Material</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_material_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_material_by_name" title="Link to this definition"></a></dt>
<dd><p>Get material by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>material_name</strong> – Material name (e.g., “CLASS_2_CONTAMINATED”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Material instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_source_by_name">
<span class="sig-name descname"><span class="pre">get_source_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.Source" title="truck_tickets.models.sql_reference.Source"><span class="pre">Source</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_source_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_source_by_name" title="Link to this definition"></a></dt>
<dd><p>Get source by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>source_name</strong> – Source name (e.g., “SPG”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Source instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_destination_by_name">
<span class="sig-name descname"><span class="pre">get_destination_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">destination_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.Destination" title="truck_tickets.models.sql_reference.Destination"><span class="pre">Destination</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_destination_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_destination_by_name" title="Link to this definition"></a></dt>
<dd><p>Get destination by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>destination_name</strong> – Destination name (e.g., “WASTE_MANAGEMENT_LEWISVILLE”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Destination instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_vendor_by_name">
<span class="sig-name descname"><span class="pre">get_vendor_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vendor_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.Vendor" title="truck_tickets.models.sql_reference.Vendor"><span class="pre">Vendor</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_vendor_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_vendor_by_name" title="Link to this definition"></a></dt>
<dd><p>Get vendor by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>vendor_name</strong> – Vendor name (e.g., “WASTE_MANAGEMENT”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Vendor instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_ticket_type_by_name">
<span class="sig-name descname"><span class="pre">get_ticket_type_by_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_type_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_reference.TicketType" title="truck_tickets.models.sql_reference.TicketType"><span class="pre">TicketType</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_ticket_type_by_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_ticket_type_by_name" title="Link to this definition"></a></dt>
<dd><p>Get ticket type by canonical name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ticket_type_name</strong> – Ticket type name (e.g., “EXPORT”)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>TicketType instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.create">
<span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticket_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">material_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticket_type_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'EXPORT'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">destination_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vendor_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">manifest_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Decimal" title="(in Python v3.14)"><span class="pre">Decimal</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantity_unit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">truck_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_page</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_hash</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">request_guid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_confidence</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Decimal" title="(in Python v3.14)"><span class="pre">Decimal</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_duplicates</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validate_manifest</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.create"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.create" title="Link to this definition"></a></dt>
<dd><p>Create a new truck ticket.</p>
<p>This method:
1. Resolves all foreign keys by canonical names
2. Validates manifest requirement (if enabled)
3. Checks for duplicates (if enabled)
4. Creates the ticket record
5. Commits the transaction</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_number</strong> – Ticket number from vendor</p></li>
<li><p><strong>ticket_date</strong> – Date of the ticket</p></li>
<li><p><strong>job_name</strong> – Job canonical name (e.g., “24-105”)</p></li>
<li><p><strong>material_name</strong> – Material canonical name</p></li>
<li><p><strong>ticket_type_name</strong> – Ticket type (“EXPORT” or “IMPORT”)</p></li>
<li><p><strong>source_name</strong> – Source canonical name (optional)</p></li>
<li><p><strong>destination_name</strong> – Destination canonical name (optional)</p></li>
<li><p><strong>vendor_name</strong> – Vendor canonical name (optional)</p></li>
<li><p><strong>manifest_number</strong> – Manifest number (required for contaminated)</p></li>
<li><p><strong>quantity</strong> – Quantity value</p></li>
<li><p><strong>quantity_unit</strong> – Unit of measurement</p></li>
<li><p><strong>truck_number</strong> – Truck number (v1.1 field)</p></li>
<li><p><strong>file_id</strong> – Source file path</p></li>
<li><p><strong>file_page</strong> – Page number in file</p></li>
<li><p><strong>file_hash</strong> – SHA-256 hash of file</p></li>
<li><p><strong>request_guid</strong> – Batch processing GUID</p></li>
<li><p><strong>extraction_confidence</strong> – OCR confidence score</p></li>
<li><p><strong>check_duplicates</strong> – Whether to check for duplicates (default: True)</p></li>
<li><p><strong>validate_manifest</strong> – Whether to validate manifest (default: True)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Created TruckTicket instance</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="#truck_tickets.database.ForeignKeyNotFoundError" title="truck_tickets.database.ticket_repository.ForeignKeyNotFoundError"><strong>ForeignKeyNotFoundError</strong></a> – If required foreign key not found</p></li>
<li><p><a class="reference internal" href="#truck_tickets.database.ValidationError" title="truck_tickets.database.ticket_repository.ValidationError"><strong>ValidationError</strong></a> – If manifest validation fails</p></li>
<li><p><a class="reference internal" href="#truck_tickets.database.DuplicateTicketError" title="truck_tickets.database.ticket_repository.DuplicateTicketError"><strong>DuplicateTicketError</strong></a> – If duplicate detected</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id98"><span class="problematic" id="id99">``</span></a><a href="#id100"><span class="problematic" id="id101">`</span></a>python
ticket = repo.create(</p>
<blockquote>
<div><p>ticket_number=”WM-12345678”,
ticket_date=date(2024, 10, 17),
job_name=”24-105”,
material_name=”CLASS_2_CONTAMINATED”,
manifest_number=”WM-MAN-2024-001234”,
quantity=Decimal(“25.5”),
quantity_unit=”TONS”</p>
</div></blockquote>
<section id="id102">
<h3>)<a class="headerlink" href="#id102" title="Link to this heading"></a></h3>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_by_id">
<span class="sig-name descname"><span class="pre">get_by_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_by_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_by_id" title="Link to this definition"></a></dt>
<dd><p>Get ticket by ID.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ticket_id</strong> – Ticket ID</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>TruckTicket instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_by_ticket_number">
<span class="sig-name descname"><span class="pre">get_by_ticket_number</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vendor_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_by_ticket_number"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_by_ticket_number" title="Link to this definition"></a></dt>
<dd><p>Get ticket by ticket number and optional vendor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_number</strong> – Ticket number</p></li>
<li><p><strong>vendor_id</strong> – Optional vendor ID for disambiguation</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>TruckTicket instance or None if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_by_date_range">
<span class="sig-name descname"><span class="pre">get_by_date_range</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_by_date_range"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_by_date_range" title="Link to this definition"></a></dt>
<dd><p>Get tickets within date range.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> – Start date (inclusive)</p></li>
<li><p><strong>end_date</strong> – End date (inclusive)</p></li>
<li><p><strong>job_id</strong> – Optional job ID filter</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of TruckTicket instances</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.update" title="Link to this definition"></a></dt>
<dd><p>Update ticket fields.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_id</strong> – Ticket ID to update</p></li>
<li><p><strong>**kwargs</strong> – Fields to update</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Updated TruckTicket instance</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#truck_tickets.database.TicketRepositoryError" title="truck_tickets.database.ticket_repository.TicketRepositoryError"><strong>TicketRepositoryError</strong></a> – If ticket not found or update fails</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id103"><span class="problematic" id="id104">``</span></a><a href="#id105"><span class="problematic" id="id106">`</span></a>python
ticket = repo.update(</p>
<blockquote>
<div><p>ticket_id=123,
quantity=Decimal(“26.0”),
manifest_number=”WM-MAN-2024-001235”</p>
</div></blockquote>
<section id="id107">
<h3>)<a class="headerlink" href="#id107" title="Link to this heading"></a></h3>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.soft_delete">
<span class="sig-name descname"><span class="pre">soft_delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.soft_delete"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.soft_delete" title="Link to this definition"></a></dt>
<dd><p>Soft delete ticket (mark as inactive, don’t remove).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ticket_id</strong> – Ticket ID to delete</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if deleted, False if not found</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This doesn’t actually delete the record, just marks it as inactive.
Use hard_delete() if you need to actually remove the record.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.hard_delete">
<span class="sig-name descname"><span class="pre">hard_delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.hard_delete"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.hard_delete" title="Link to this definition"></a></dt>
<dd><p>Permanently delete ticket from database.</p>
<p>WARNING: This permanently removes the record. Use soft_delete() instead
for most cases to maintain audit trail.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ticket_id</strong> – Ticket ID to delete</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if deleted, False if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.count_by_job">
<span class="sig-name descname"><span class="pre">count_by_job</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.count_by_job"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.count_by_job" title="Link to this definition"></a></dt>
<dd><p>Count tickets for a job.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>job_id</strong> – Job ID</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Number of tickets</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_duplicates">
<span class="sig-name descname"><span class="pre">get_duplicates</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_duplicates"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_duplicates" title="Link to this definition"></a></dt>
<dd><p>Get all tickets marked as duplicates.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of duplicate tickets</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.get_requiring_review">
<span class="sig-name descname"><span class="pre">get_requiring_review</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.get_requiring_review"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.get_requiring_review" title="Link to this definition"></a></dt>
<dd><p>Get all tickets requiring manual review.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of tickets needing review</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.ticket_repository.TicketRepository.search">
<span class="sig-name descname"><span class="pre">search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">material_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vendor_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">has_manifest</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_truck_ticket.TruckTicket" title="truck_tickets.models.sql_truck_ticket.TruckTicket"><span class="pre">TruckTicket</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/ticket_repository.html#TicketRepository.search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.ticket_repository.TicketRepository.search" title="Link to this definition"></a></dt>
<dd><p>Search tickets with multiple filters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_number</strong> – Partial ticket number match</p></li>
<li><p><strong>job_id</strong> – Job ID filter</p></li>
<li><p><strong>material_id</strong> – Material ID filter</p></li>
<li><p><strong>vendor_id</strong> – Vendor ID filter</p></li>
<li><p><strong>start_date</strong> – Start date filter</p></li>
<li><p><strong>end_date</strong> – End date filter</p></li>
<li><p><strong>has_manifest</strong> – Filter by manifest presence</p></li>
<li><p><strong>limit</strong> – Maximum results (default: 100)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of matching tickets</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="duplicate-detector">
<h2>Duplicate Detector<a class="headerlink" href="#duplicate-detector" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="truck_tickets.database.duplicate_detector.DuplicateDetector">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.duplicate_detector.</span></span><span class="sig-name descname"><span class="pre">DuplicateDetector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">120</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.duplicate_detector.DuplicateDetector" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Detects duplicate tickets using 120-day rolling window.</p>
<p>This class implements the duplicate detection strategy defined in spec v1.1:
- Check for existing ticket with same (ticket_number, vendor_id)
- Within rolling 120-day window before current ticket date
- If found: Mark as duplicate and route to review queue</p>
<p class="rubric">Example</p>
<p><a href="#id108"><span class="problematic" id="id109">``</span></a><a href="#id110"><span class="problematic" id="id111">`</span></a>python
detector = DuplicateDetector(session)
result = detector.check_duplicate(</p>
<blockquote>
<div><p>ticket_number=”WM-12345678”,
vendor_id=1,
ticket_date=date(2024, 10, 17)</p>
</div></blockquote>
<p>)</p>
<dl class="simple">
<dt>if result.is_duplicate:</dt><dd><p>print(f”Duplicate found! Original: {result.original_ticket_id}”)
print(f”Days apart: {result.days_apart}”)</p>
</dd>
</dl>
<p><a href="#id112"><span class="problematic" id="id113">``</span></a><a href="#id114"><span class="problematic" id="id115">`</span></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.duplicate_detector.DuplicateDetector.session">
<span class="sig-name descname"><span class="pre">session</span></span><a class="headerlink" href="#truck_tickets.database.duplicate_detector.DuplicateDetector.session" title="Link to this definition"></a></dt>
<dd><p>SQLAlchemy database session</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="truck_tickets.database.duplicate_detector.DuplicateDetector.window_days">
<span class="sig-name descname"><span class="pre">window_days</span></span><a class="headerlink" href="#truck_tickets.database.duplicate_detector.DuplicateDetector.window_days" title="Link to this definition"></a></dt>
<dd><p>Number of days for rolling window (default: 120)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.duplicate_detector.DuplicateDetector.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">120</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.duplicate_detector.DuplicateDetector.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize duplicate detector.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> – SQLAlchemy database session</p></li>
<li><p><strong>window_days</strong> – Number of days for rolling window (default: 120)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.duplicate_detector.DuplicateDetector.check_duplicate">
<span class="sig-name descname"><span class="pre">check_duplicate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vendor_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticket_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult" title="truck_tickets.database.duplicate_detector.DuplicateDetectionResult"><span class="pre">DuplicateDetectionResult</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.check_duplicate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.duplicate_detector.DuplicateDetector.check_duplicate" title="Link to this definition"></a></dt>
<dd><p>Check if ticket is a duplicate within rolling window.</p>
<p>Queries database for existing ticket with matching (ticket_number, vendor_id)
within the rolling window period. The window extends from (ticket_date - window_days)
to ticket_date.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_number</strong> – Ticket number to check (e.g., “WM-12345678”)</p></li>
<li><p><strong>vendor_id</strong> – Vendor ID (can be None if vendor unknown)</p></li>
<li><p><strong>ticket_date</strong> – Date of the ticket being checked</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DuplicateDetectionResult with is_duplicate=True if match found</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id116"><span class="problematic" id="id117">``</span></a><a href="#id118"><span class="problematic" id="id119">`</span></a>python
result = detector.check_duplicate(</p>
<blockquote>
<div><p>ticket_number=”WM-12345678”,
vendor_id=1,
ticket_date=date(2024, 10, 17)</p>
</div></blockquote>
<section id="id120">
<h3>)<a class="headerlink" href="#id120" title="Link to this heading"></a></h3>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.duplicate_detector.DuplicateDetector.mark_as_duplicate">
<span class="sig-name descname"><span class="pre">mark_as_duplicate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Duplicate</span> <span class="pre">ticket</span> <span class="pre">detected</span> <span class="pre">within</span> <span class="pre">120-day</span> <span class="pre">window'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.mark_as_duplicate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.duplicate_detector.DuplicateDetector.mark_as_duplicate" title="Link to this definition"></a></dt>
<dd><p>Mark a ticket as duplicate and set review flag.</p>
<p>Updates the ticket record to:
- Set duplicate_of = original_ticket_id
- Set review_required = True
- Set review_reason = reason</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_id</strong> – ID of the duplicate ticket to mark</p></li>
<li><p><strong>original_ticket_id</strong> – ID of the original ticket</p></li>
<li><p><strong>reason</strong> – Reason for marking as duplicate</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id121"><span class="problematic" id="id122">``</span></a><a href="#id123"><span class="problematic" id="id124">`</span></a>python
detector.mark_as_duplicate(</p>
<blockquote>
<div><p>ticket_id=456,
original_ticket_id=123,
reason=”Duplicate ticket - same number and vendor”</p>
</div></blockquote>
<section id="id125">
<h3>)<a class="headerlink" href="#id125" title="Link to this heading"></a></h3>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.duplicate_detector.DuplicateDetector.create_review_queue_entry">
<span class="sig-name descname"><span class="pre">create_review_queue_entry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">detected_fields</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suggested_fixes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ReviewQueue" title="truck_tickets.models.sql_processing.ReviewQueue"><span class="pre">ReviewQueue</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.create_review_queue_entry"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.duplicate_detector.DuplicateDetector.create_review_queue_entry" title="Link to this definition"></a></dt>
<dd><p>Create review queue entry for duplicate ticket.</p>
<p>Routes the duplicate ticket to the review queue with WARNING severity.
Includes details about both the original and duplicate tickets for
manual review.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_id</strong> – ID of the duplicate ticket</p></li>
<li><p><strong>original_ticket_id</strong> – ID of the original ticket</p></li>
<li><p><strong>detected_fields</strong> – Dictionary of detected field values (optional)</p></li>
<li><p><strong>suggested_fixes</strong> – Dictionary of suggested corrections (optional)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Created ReviewQueue entry</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id126"><span class="problematic" id="id127">``</span></a><a href="#id128"><span class="problematic" id="id129">`</span></a>python
review_entry = detector.create_review_queue_entry(</p>
<blockquote>
<div><p>ticket_id=456,
original_ticket_id=123,
detected_fields={</p>
<blockquote>
<div><p>“ticket_number”: “WM-12345678”,
“ticket_date”: “2024-10-17”,
“vendor”: “Waste Management”</p>
</div></blockquote>
<p>},
suggested_fixes={</p>
<blockquote>
<div><p>“action”: “Verify if re-scan or legitimate duplicate load”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<section id="id130">
<h3>)<a class="headerlink" href="#id130" title="Link to this heading"></a></h3>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.duplicate_detector.DuplicateDetector.check_and_handle_duplicate">
<span class="sig-name descname"><span class="pre">check_and_handle_duplicate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ticket_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">vendor_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticket_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ticket_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#truck_tickets.database.DuplicateDetectionResult" title="truck_tickets.database.duplicate_detector.DuplicateDetectionResult"><span class="pre">DuplicateDetectionResult</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.check_and_handle_duplicate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.duplicate_detector.DuplicateDetector.check_and_handle_duplicate" title="Link to this definition"></a></dt>
<dd><p>Check for duplicate and automatically handle if found.</p>
<p>This is a convenience method that combines check_duplicate(),
mark_as_duplicate(), and create_review_queue_entry() into a single call.</p>
<p>If a duplicate is found:
1. Marks the ticket as duplicate
2. Creates review queue entry
3. Returns detection result</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ticket_number</strong> – Ticket number to check</p></li>
<li><p><strong>vendor_id</strong> – Vendor ID (can be None)</p></li>
<li><p><strong>ticket_date</strong> – Date of the ticket</p></li>
<li><p><strong>ticket_id</strong> – ID of the ticket being checked (required if duplicate found)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DuplicateDetectionResult</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id131"><span class="problematic" id="id132">``</span></a><a href="#id133"><span class="problematic" id="id134">`</span></a>python
result = detector.check_and_handle_duplicate(</p>
<blockquote>
<div><p>ticket_number=”WM-12345678”,
vendor_id=1,
ticket_date=date(2024, 10, 17),
ticket_id=456</p>
</div></blockquote>
<p>)</p>
<dl class="simple">
<dt>if result.is_duplicate:</dt><dd><p>print(f”Duplicate handled! Routed to review queue.”)</p>
</dd>
</dl>
<p><a href="#id135"><span class="problematic" id="id136">``</span></a><a href="#id137"><span class="problematic" id="id138">`</span></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.duplicate_detector.DuplicateDetector.get_duplicate_statistics">
<span class="sig-name descname"><span class="pre">get_duplicate_statistics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.14)"><span class="pre">date</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/duplicate_detector.html#DuplicateDetector.get_duplicate_statistics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.duplicate_detector.DuplicateDetector.get_duplicate_statistics" title="Link to this definition"></a></dt>
<dd><p>Get statistics about duplicate detection.</p>
<p>Returns counts and metrics about duplicates found in the system.
Useful for monitoring and reporting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> – Optional start date for filtering</p></li>
<li><p><strong>end_date</strong> – Optional end date for filtering</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary with duplicate statistics</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id139"><span class="problematic" id="id140">``</span></a><a href="#id141"><span class="problematic" id="id142">`</span></a>python
stats = detector.get_duplicate_statistics(</p>
<blockquote>
<div><p>start_date=date(2024, 10, 1),
end_date=date(2024, 10, 31)</p>
</div></blockquote>
<p>)
print(f”Duplicates found: {stats[‘total_duplicates’]}”)
print(f”Duplicate rate: {stats[‘duplicate_rate’]:.2%}”)
<a href="#id143"><span class="problematic" id="id144">``</span></a><a href="#id145"><span class="problematic" id="id146">`</span></a></p>
</dd></dl>

</dd></dl>

</section>
<section id="processing-run-ledger">
<h2>Processing Run Ledger<a class="headerlink" href="#processing-run-ledger" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">truck_tickets.database.processing_run_ledger.</span></span><span class="sig-name descname"><span class="pre">ProcessingRunLedger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Manages processing run tracking and audit trail.</p>
<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize processing run ledger.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>session</strong> – SQLAlchemy database session</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.start_run">
<span class="sig-name descname"><span class="pre">start_run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">processed_by</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_snapshot</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.14)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">request_guid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ProcessingRun" title="truck_tickets.models.sql_processing.ProcessingRun"><span class="pre">ProcessingRun</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.start_run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.start_run" title="Link to this definition"></a></dt>
<dd><p>Start a new processing run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>processed_by</strong> – User or process identifier</p></li>
<li><p><strong>config_snapshot</strong> – Configuration used for this run</p></li>
<li><p><strong>request_guid</strong> – Optional custom GUID (auto-generated if not provided)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ProcessingRun instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.update_run_progress">
<span class="sig-name descname"><span class="pre">update_run_progress</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request_guid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">files_count</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pages_count</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tickets_created</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tickets_updated</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duplicates_found</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">review_queue_count</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_count</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ProcessingRun" title="truck_tickets.models.sql_processing.ProcessingRun"><span class="pre">ProcessingRun</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.update_run_progress"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.update_run_progress" title="Link to this definition"></a></dt>
<dd><p>Update processing run statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request_guid</strong> – Processing run identifier</p></li>
<li><p><strong>files_count</strong> – Number of files processed</p></li>
<li><p><strong>pages_count</strong> – Number of pages processed</p></li>
<li><p><strong>tickets_created</strong> – Number of new tickets created</p></li>
<li><p><strong>tickets_updated</strong> – Number of existing tickets updated</p></li>
<li><p><strong>duplicates_found</strong> – Number of duplicate tickets found</p></li>
<li><p><strong>review_queue_count</strong> – Number of items sent to review queue</p></li>
<li><p><strong>error_count</strong> – Number of errors encountered</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Updated ProcessingRun instance</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If processing run not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.complete_run">
<span class="sig-name descname"><span class="pre">complete_run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request_guid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">status</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'COMPLETED'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">final_stats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ProcessingRun" title="truck_tickets.models.sql_processing.ProcessingRun"><span class="pre">ProcessingRun</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.complete_run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.complete_run" title="Link to this definition"></a></dt>
<dd><p>Complete a processing run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request_guid</strong> – Processing run identifier</p></li>
<li><p><strong>status</strong> – Final status (COMPLETED, FAILED)</p></li>
<li><p><strong>final_stats</strong> – Final statistics to update</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Completed ProcessingRun instance</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If processing run not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.fail_run">
<span class="sig-name descname"><span class="pre">fail_run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request_guid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_message</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ProcessingRun" title="truck_tickets.models.sql_processing.ProcessingRun"><span class="pre">ProcessingRun</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.fail_run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.fail_run" title="Link to this definition"></a></dt>
<dd><p>Mark a processing run as failed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request_guid</strong> – Processing run identifier</p></li>
<li><p><strong>error_message</strong> – Optional error description</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Failed ProcessingRun instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_run_by_guid">
<span class="sig-name descname"><span class="pre">get_run_by_guid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request_guid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ProcessingRun" title="truck_tickets.models.sql_processing.ProcessingRun"><span class="pre">ProcessingRun</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.get_run_by_guid"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_run_by_guid" title="Link to this definition"></a></dt>
<dd><p>Get processing run by GUID.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>request_guid</strong> – Processing run identifier</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ProcessingRun instance</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If processing run not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_recent_runs">
<span class="sig-name descname"><span class="pre">get_recent_runs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">limit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ProcessingRun" title="truck_tickets.models.sql_processing.ProcessingRun"><span class="pre">ProcessingRun</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.get_recent_runs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_recent_runs" title="Link to this definition"></a></dt>
<dd><p>Get recent processing runs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>limit</strong> – Maximum number of runs to return</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of ProcessingRun instances</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_runs_by_user">
<span class="sig-name descname"><span class="pre">get_runs_by_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">processed_by</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ProcessingRun" title="truck_tickets.models.sql_processing.ProcessingRun"><span class="pre">ProcessingRun</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.get_runs_by_user"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_runs_by_user" title="Link to this definition"></a></dt>
<dd><p>Get processing runs by user.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>processed_by</strong> – User identifier</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of ProcessingRun instances</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_failed_runs">
<span class="sig-name descname"><span class="pre">get_failed_runs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ProcessingRun" title="truck_tickets.models.sql_processing.ProcessingRun"><span class="pre">ProcessingRun</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.get_failed_runs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_failed_runs" title="Link to this definition"></a></dt>
<dd><p>Get all failed processing runs.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of failed ProcessingRun instances</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_in_progress_runs">
<span class="sig-name descname"><span class="pre">get_in_progress_runs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="models.html#truck_tickets.models.sql_processing.ProcessingRun" title="truck_tickets.models.sql_processing.ProcessingRun"><span class="pre">ProcessingRun</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.get_in_progress_runs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_in_progress_runs" title="Link to this definition"></a></dt>
<dd><p>Get all in-progress processing runs.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of in-progress ProcessingRun instances</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.cleanup_old_runs">
<span class="sig-name descname"><span class="pre">cleanup_old_runs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">days_to_keep</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">90</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.cleanup_old_runs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.cleanup_old_runs" title="Link to this definition"></a></dt>
<dd><p>Clean up old processing runs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>days_to_keep</strong> – Number of days to keep runs</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Number of runs deleted</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_processing_statistics">
<span class="sig-name descname"><span class="pre">get_processing_statistics</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.14)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/truck_tickets/database/processing_run_ledger.html#ProcessingRunLedger.get_processing_statistics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.processing_run_ledger.ProcessingRunLedger.get_processing_statistics" title="Link to this definition"></a></dt>
<dd><p>Get overall processing statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary with processing statistics</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="schema-setup">
<h2>Schema Setup<a class="headerlink" href="#schema-setup" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.schema_setup.create_database_schema">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.schema_setup.</span></span><span class="sig-name descname"><span class="pre">create_database_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#truck_tickets.database.connection.DatabaseConnection" title="truck_tickets.database.connection.DatabaseConnection"><span class="pre">DatabaseConnection</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/schema_setup.html#create_database_schema"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.schema_setup.create_database_schema" title="Link to this definition"></a></dt>
<dd><p>Create all required database tables and indexes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>db</strong> – DatabaseConnection instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.schema_setup.seed_reference_data">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.schema_setup.</span></span><span class="sig-name descname"><span class="pre">seed_reference_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#truck_tickets.database.connection.DatabaseConnection" title="truck_tickets.database.connection.DatabaseConnection"><span class="pre">DatabaseConnection</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_code</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'24-105'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/schema_setup.html#seed_reference_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.schema_setup.seed_reference_data" title="Link to this definition"></a></dt>
<dd><p>Seed reference data for initial testing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> – DatabaseConnection instance</p></li>
<li><p><strong>job_code</strong> – Job code to create (default: 24-105)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="sqlalchemy-schema-setup">
<h2>SQLAlchemy Schema Setup<a class="headerlink" href="#sqlalchemy-schema-setup" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.sqlalchemy_schema_setup.create_all_tables">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.sqlalchemy_schema_setup.</span></span><span class="sig-name descname"><span class="pre">create_all_tables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">engine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/core/connections.html#sqlalchemy.engine.Engine" title="(in SQLAlchemy v2.0)"><span class="pre">Engine</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/sqlalchemy_schema_setup.html#create_all_tables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.sqlalchemy_schema_setup.create_all_tables" title="Link to this definition"></a></dt>
<dd><p>Create all database tables from SQLAlchemy models.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>engine</strong> – SQLAlchemy engine instance</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id147"><span class="problematic" id="id148">``</span></a><a href="#id149"><span class="problematic" id="id150">`</span></a>python
from sqlalchemy import create_engine</p>
<p>engine = create_engine(‘sqlite:///truck_tickets.db’)
create_all_tables(engine)
<a href="#id151"><span class="problematic" id="id152">``</span></a><a href="#id153"><span class="problematic" id="id154">`</span></a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="truck_tickets.database.sqlalchemy_schema_setup.seed_reference_data">
<span class="sig-prename descclassname"><span class="pre">truck_tickets.database.sqlalchemy_schema_setup.</span></span><span class="sig-name descname"><span class="pre">seed_reference_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.sqlalchemy.org/en/20/orm/session_api.html#sqlalchemy.orm.Session" title="(in SQLAlchemy v2.0)"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_code</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'24-105'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'PHMS</span> <span class="pre">New</span> <span class="pre">Pediatric</span> <span class="pre">Campus'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a></span></span><a class="reference internal" href="../_modules/truck_tickets/database/sqlalchemy_schema_setup.html#seed_reference_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#truck_tickets.database.sqlalchemy_schema_setup.seed_reference_data" title="Link to this definition"></a></dt>
<dd><p>Seed all reference data for testing and production.</p>
<dl class="simple">
<dt>Seeds:</dt><dd><ul class="simple">
<li><p>1 job (24-105)</p></li>
<li><p>12 materials (contaminated, clean, import types)</p></li>
<li><p>13 sources (construction site locations)</p></li>
<li><p>3 destinations (disposal facilities)</p></li>
<li><p>3 vendors (haulers)</p></li>
<li><p>2 ticket types (IMPORT, EXPORT)</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> – SQLAlchemy session</p></li>
<li><p><strong>job_code</strong> – Job code (default: “24-105”)</p></li>
<li><p><strong>job_name</strong> – Job name (default: “PHMS New Pediatric Campus”)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary with counts of seeded records</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a href="#id155"><span class="problematic" id="id156">``</span></a><a href="#id157"><span class="problematic" id="id158">`</span></a>python
from sqlalchemy.orm import Session</p>
<p>counts = seed_reference_data(session)
print(f”Seeded {counts[‘materials’]} materials”)
<a href="#id159"><span class="problematic" id="id160">``</span></a><a href="#id161"><span class="problematic" id="id162">`</span></a></p>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="processing.html" class="btn btn-neutral float-left" title="Processing Modules" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="extractors.html" class="btn btn-neutral float-right" title="Field Extractors" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, DocTR Process Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>

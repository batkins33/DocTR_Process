# Vendor Template: Waste Management Lewisville
# Primary vendor for contaminated material disposal
# Project 24-105: Construction Site Material Tracking

vendor:
  name: "WASTE_MANAGEMENT_LEWISVILLE"
  display_name: "Waste Management Lewisville"
  vendor_code: "WM"
  aliases:
    - "Waste Management"
    - "WM"
    - "WM Lewisville"
    - "Waste Mgmt"
    - "Waste Management Lewisville"

# Logo detection configuration
logo:
  type: "image_template"
  # Path to logo template image (relative to templates/vendors/)
  path: "assets/wm_logo.png"
  # Region of Interest for logo detection (top-left of page)
  roi:
    x: 0
    y: 0
    width: 200
    height: 100
  # Confidence threshold for template matching
  threshold: 0.85
  method: "template_match"  # or "feature_match"

# Alternative logo detection via text
logo_text:
  keywords:
    - "Waste Management"
    - "WM Environmental"
  roi:
    x: 0
    y: 0
    width: 400
    height: 150

# Ticket number extraction
ticket_number:
  label: "Ticket Number"
  regex:
    # Primary pattern: WM-12345678 (8 digits)
    - pattern: '\bWM-\d{8}\b'
      priority: 1
    # Alternative: 10-digit number
    - pattern: '\b\d{10}\b'
      priority: 2
    # Fallback: 7-10 digit sequence
    - pattern: '\b\d{7,10}\b'
      priority: 3
  # Region of Interest (top-right corner)
  roi:
    x: 1400
    y: 50
    width: 200
    height: 100
    relative: false  # Absolute pixel coordinates
  required: true
  validation:
    min_length: 7
    max_length: 10
    exclude_patterns:
      - '^\d{8}$'  # Exclude date-like 8-digit numbers (20241017)

# Manifest number extraction (CRITICAL for contaminated material)
manifest_number:
  label: "Manifest Number"
  regex:
    # Primary pattern: WM-MAN-2024-001234
    - pattern: '\bMANIFEST\s*#?\s*:?\s*(WM-MAN-\d{4}-\d{6})\b'
      priority: 1
      capture_group: 1
    # Alternative: MAN# : ABC-123456
    - pattern: '\bMAN\s*#?\s*:?\s*([A-Z0-9-]{10,})\b'
      priority: 2
      capture_group: 1
    # Fallback: MANIFEST followed by alphanumeric
    - pattern: '\bMANIFEST[:\s]+([A-Z0-9-]{6,20})\b'
      priority: 3
      capture_group: 1
  # Region of Interest (middle-left area)
  roi:
    x: 100
    y: 300
    width: 600
    height: 100
  required: true  # CRITICAL: contaminated material MUST have manifest
  validation:
    pattern: '^[A-Z0-9-]{6,20}$'
    min_length: 6
    max_length: 20

# Date extraction
date:
  label: "Date"
  formats:
    - "MM/DD/YYYY"
    - "M/D/YYYY"
    - "MM-DD-YYYY"
    - "YYYY-MM-DD"
  regex:
    - pattern: '\b(\d{1,2}/\d{1,2}/\d{4})\b'
      priority: 1
    - pattern: '\b(\d{4}-\d{2}-\d{2})\b'
      priority: 2
  roi:
    x: 1400
    y: 150
    width: 200
    height: 50
  required: true
  validation:
    min_year: 2020
    max_year: 2030

# Source location (excavation area on site)
source:
  label: "Source"
  regex:
    - pattern: 'Source:\s*([A-Za-z0-9\s]+)'
      capture_group: 1
    - pattern: 'From:\s*([A-Za-z0-9\s]+)'
      capture_group: 1
    - pattern: 'Origin:\s*([A-Za-z0-9\s]+)'
      capture_group: 1
  roi:
    x: 100
    y: 200
    width: 400
    height: 80
  required: false
  # Apply synonym normalization
  normalize: true

# Destination (should default to WM Lewisville)
destination:
  label: "Destination"
  default: "WASTE_MANAGEMENT_LEWISVILLE"
  regex:
    - pattern: 'Destination:\s*([A-Za-z0-9\s]+)'
      capture_group: 1
    - pattern: 'To:\s*([A-Za-z0-9\s]+)'
      capture_group: 1
  roi:
    x: 100
    y: 400
    width: 400
    height: 80

# Material type (should default to CLASS_2_CONTAMINATED)
material:
  label: "Material Type"
  default: "CLASS_2_CONTAMINATED"
  keywords:
    - "Class 2"
    - "Class2"
    - "Contaminated"
    - "Regulated"
  # For WM, always contaminated unless specified otherwise
  assume_contaminated: true

# Quantity extraction
quantity:
  label: "Quantity"
  regex:
    - pattern: '(\d+(?:\.\d{1,2})?)\s*TONS?'
      capture_group: 1
      unit: "TONS"
    - pattern: '(\d+(?:\.\d{1,2})?)\s*(?:CY|CUBIC\s*YARDS?)'
      capture_group: 1
      unit: "CY"
  roi:
    x: 800
    y: 400
    width: 300
    height: 100
  unit: "TONS"
  validation:
    min: 0.0
    max: 50.0
    warning_min: 5.0
    warning_max: 30.0

# Truck number (optional, for tracking)
truck_number:
  label: "Truck Number"
  regex:
    - pattern: 'Truck\s*#?\s*:?\s*(\d+)'
      capture_group: 1
    - pattern: 'Vehicle\s*#?\s*:?\s*(\d+)'
      capture_group: 1
  roi:
    x: 100
    y: 500
    width: 300
    height: 60
  required: false

# Driver name (optional)
driver:
  label: "Driver"
  regex:
    - pattern: 'Driver:\s*([A-Za-z\s]+)'
      capture_group: 1
  roi:
    x: 100
    y: 560
    width: 300
    height: 60
  required: false

# Processing hints
processing:
  # Ticket type is always EXPORT for WM
  ticket_type: "EXPORT"
  # Material always requires manifest
  requires_manifest: true
  # Confidence threshold for accepting extraction
  min_confidence: 0.75
  # OCR preprocessing
  preprocessing:
    - "deskew"
    - "denoise"
    - "sharpen"
  # Post-processing
  postprocessing:
    - "normalize_whitespace"
    - "remove_special_chars"

# Quality checks
quality_checks:
  # Flag for review if any of these fail
  critical:
    - field: "ticket_number"
      check: "not_empty"
    - field: "manifest_number"
      check: "not_empty"
    - field: "date"
      check: "valid_date"
  
  warnings:
    - field: "quantity"
      check: "in_range"
      min: 5.0
      max: 30.0
    - field: "source"
      check: "known_value"

# Notes
notes: |
  Waste Management Lewisville is the primary disposal facility for
  Class 2 contaminated material from Project 24-105. All tickets from
  this vendor MUST include a manifest number for regulatory compliance.
  
  Typical ticket format:
  - Logo in top-left
  - Ticket number in top-right (8-10 digits)
  - Manifest number in body (format: WM-MAN-YYYY-NNNNNN)
  - Date in top-right below ticket number
  - Quantity in tons (typically 10-25 tons per load)
